{
	"info": {
		"_postman_id": "9eb4bb6b-c235-4492-b7a8-4ae885e0c4b0",
		"name": "Pet Store Scripting",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "POST",
			"item": [
				{
					"name": "create new pet id autogenerated",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7cd06f0d-78e1-4ce9-b993-698e72deb6bf",
								"exec": [
									"let response = pm.response.text();\r",
									"console.log('Original response:', response); // Check the raw response\r",
									"\r",
									"let modified = response.replace(/([^\"\\w-])([-0-9.]{8,100})([^\"\\w-])/g, '$1\"$2\"$3');\r",
									"console.log('Modified response:', modified); // See if ID got quoted\r",
									"\r",
									"let jsonData = JSON.parse(modified);\r",
									"console.log('Parsed ID type:', typeof jsonData.id); // Should be \"string\"\r",
									"console.log('Parsed ID value:', jsonData.id);\r",
									"let id = jsonData.id; \r",
									"\r",
									"console.log(\"Pet id is \" + id, \"and it is stored in collection variable 'petIdForCollection'\");\r",
									"\r",
									"pm.collectionVariables.set(\"petIdForCollection\", id);\r",
									"\r",
									"var petTestCategoryNameExpected = pm.variables.get(\"petTestCategoryName\");\r",
									"//console.log(petTestCategoryNameExpected);\r",
									"\r",
									"pm.test(\"PetCreated_CategoryNameEqualsCategoryNamePredefined_WhenCategoryNameGeneratedInPreRequestScript\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.category.name).to.eql(petTestCategoryNameExpected);\r",
									"});\r",
									"\r",
									"pm.test(\"PetCreated_FirstTagIdIsZero\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    console.log(\"category: \" + jsonData.tags[0].name);\r",
									"    pm.expect(jsonData.tags[0].id).to.eql(0);\r",
									"});\r",
									"\r",
									"pm.test(\"PetCreated_ResponseTimeBelow200ms\", function () {\r",
									"    pm.expect(pm.response.responseTime).to.be.below(1000);\r",
									"});\r",
									"\r",
									"pm.test(\"PetCreated_StatusCodeOK\", function () {\r",
									"    pm.response.to.have.status(\"OK\");\r",
									"});\r",
									"\r",
									"pm.test(\"PetCreated_SuccessfulResposeCode\", function () {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201, 202, 204]);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9a8296c9-cdfa-4b21-aae4-d59cf6211367",
								"exec": [
									"var base_name = pm.variables.get(\"petRandomCategoryBaseName\"); // Get the current petRandomCategoryBaseName from the environment variables\r",
									"console.log(base_name); // Log the current base Name to the console\r",
									"\r",
									"var test_name = base_name + \" - \" + pm.variables.replaceIn('{{$randomWord}} {{$randomColor}}')\r",
									"console.log(test_name)\r",
									"\r",
									"pm.variables.set(\"petTestCategoryName\", test_name);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "c3352d70-17aa-4415-a127-770e1dbba9d0",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"id\": {{petIdForCollection}},\r\n  \"category\": {\r\n    \"id\": 0,\r\n    \"name\": \"{{petTestCategoryName}}\"\r\n  },\r\n  \"name\": \"doggie\",\r\n  \"photoUrls\": [\r\n    \"string\"\r\n  ],\r\n  \"tags\": [\r\n    {\r\n      \"id\": 0,\r\n      \"name\": \"string\"\r\n    }\r\n  ],\r\n  \"status\": \"available\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": "{{baseURL}}/{{api_v}}/pet"
					},
					"response": []
				},
				{
					"name": "thresh",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "205c88d0-1495-442d-98e5-b710b8266d84",
								"exec": [
									"pm.test(\"Body matches expected prefix\", function () {\r",
									"    pm.expect(pm.response.text()).to.include(\"additionalMetadata:\");\r",
									"});\r",
									"\r",
									"// Retrieve value from vault and make sure it has been send and response contains it\r",
									"pm.vault.get('private_name_from_vault')\r",
									"    .then((vaultValue) => {\r",
									"        if (vaultValue) {\r",
									"            pm.expect(pm.response.text()).to.include(vaultValue);\r",
									"        } else {\r",
									"            pm.test('Vault variable exists', function() {\r",
									"                pm.expect.fail('Vault variable not found');\r",
									"            });\r",
									"        }\r",
									"    })\r",
									"    .catch((error) => {\r",
									"        pm.test('Vault access successful', function() {\r",
									"            pm.expect.fail('Error accessing vault: ' + error.message);\r",
									"        });\r",
									"    });\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "f5d62da2-e56b-4045-9e39-68dd470541aa",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"uuid": "f8520580-3fd6-46fd-9555-12b9937aadf8",
									"src": "postman-cloud:///1f0c45fc-3850-4fa0-9781-01b1e4d87e35"
								},
								{
									"key": "additionalMetadata",
									"value": "{{vault:private_name_from_vault}}",
									"type": "text",
									"uuid": "e6ee1bc9-af89-412c-aab0-2bcfa2b94d2b"
								}
							]
						},
						"url": {
							"raw": "{{baseURL}}/{{api_v}}/pet/:petId/uploadImage",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"{{api_v}}",
								"pet",
								":petId",
								"uploadImage"
							],
							"variable": [
								{
									"key": "petId",
									"value": "{{petIdForCollection}}"
								}
							]
						}
					},
					"response": []
				}
			],
			"id": "d55481e7-9b5d-4ee4-aab9-0f6d2e4fbff0"
		},
		{
			"name": "GET",
			"item": [
				{
					"name": "find by status",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "4b5210eb-cd83-4a87-9eb4-e24decda4f22",
								"exec": [
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// find my ID in array\r",
									"var response = pm.response.json();\r",
									"var targetId = pm.collectionVariables.get('petIdForCollection');\r",
									"\r",
									"var foundObject = response.find(obj => obj.id == targetId);\r",
									"\r",
									"pm.test('Array contains object with ID ' + targetId, function() {\r",
									"    pm.expect(foundObject, 'Make sure that Pet which was created has actually status as expected in test. Use update Pet status if needed.').to.exist;\r",
									"});\r",
									"\r",
									"// If you need to use the found object\r",
									"if (foundObject) {\r",
									"    //console.log('Found object:', foundObject);\r",
									"    var base_name = pm.variables.get(\"petRandomCategoryBaseName\");\r",
									"\r",
									"    pm.test(\"Body matches string\", function () {\r",
									"        pm.expect(foundObject.category).to.include(base_name);\r",
									"    });\r",
									"}\r",
									"\r",
									"// Visualization\r",
									"var template = `\r",
									"<style>\r",
									"    .table-container {\r",
									"        max-height: 400px;\r",
									"        overflow: auto;\r",
									"        font-family: Arial, sans-serif;\r",
									"    }\r",
									"    table {\r",
									"        width: 100%;\r",
									"        border-collapse: collapse;\r",
									"        font-size: 14px;\r",
									"    }\r",
									"    th {\r",
									"        background-color: #4a90d9;\r",
									"        color: white;\r",
									"        padding: 10px 8px;\r",
									"        text-align: left;\r",
									"        position: sticky;\r",
									"        top: 0;\r",
									"    }\r",
									"    td {\r",
									"        padding: 8px;\r",
									"        border-bottom: 1px solid #ddd;\r",
									"    }\r",
									"    tr:nth-child(even) {\r",
									"        background-color: #f9f9f9;\r",
									"    }\r",
									"    tr:hover {\r",
									"        background-color: #f1f1f1;\r",
									"    }\r",
									"</style>\r",
									"<div class=\"table-container\">\r",
									"    <table>\r",
									"        <thead>\r",
									"            <tr>\r",
									"                <th>ID</th>\r",
									"                <th>Name</th>\r",
									"                <th>Category</th>\r",
									"                <th>Status</th>\r",
									"                <th>Tags</th>\r",
									"            </tr>\r",
									"        </thead>\r",
									"        <tbody>\r",
									"            {{#each pets}}\r",
									"            <tr>\r",
									"                <td>{{id}}</td>\r",
									"                <td>{{name}}</td>\r",
									"                <td>{{categoryName}}</td>\r",
									"                <td>{{status}}</td>\r",
									"                <td>{{tagNames}}</td>\r",
									"            </tr>\r",
									"            {{/each}}\r",
									"        </tbody>\r",
									"    </table>\r",
									"</div>\r",
									"`;\r",
									"\r",
									"function constructVisualizerPayload() {\r",
									"    var jsonData = pm.response.json();\r",
									"    var pets = jsonData.map(function(pet) {\r",
									"        return {\r",
									"            id: pet.id !== undefined ? pet.id : 'N/A',\r",
									"            name: pet.name || 'N/A',\r",
									"            categoryName: (pet.category && pet.category.name) ? pet.category.name : 'N/A',\r",
									"            status: pet.status || 'N/A',\r",
									"            tagNames: (pet.tags && pet.tags.length > 0) ? pet.tags.map(function(tag) { return tag.name || ''; }).filter(function(n) { return n; }).join(', ') : 'N/A'\r",
									"        };\r",
									"    });\r",
									"    return { pets: pets };\r",
									"}\r",
									"\r",
									"pm.visualizer.set(template, constructVisualizerPayload());"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "bf528edf-dacc-4fc7-b2db-c3c8e5ada28e",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseURL}}/{{api_v}}/pet/findByStatus?status={{var_status}}",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"{{api_v}}",
								"pet",
								"findByStatus"
							],
							"query": [
								{
									"key": "status",
									"value": "{{var_status}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "get pet by ID",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "8d915968-749b-433f-b8fa-e2e33f70351d",
								"exec": [
									"console.log('hello world pre')"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "db9b46db-0683-47a4-81d9-318ceb7809d1",
								"exec": [
									"console.log('hello merge');\r",
									"console.log('hello world');\r",
									"console.log('hello structure Pet Store Scripting -> GET -> get pet by ID');\r",
									"\r",
									"var petId = pm.collectionVariables.get(\"petIdForCollection\");\r",
									"console.log('petId: ' + petId);\r",
									"\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"PetId is correct\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    console.log(jsonData);\r",
									"    pm.expect(jsonData.id).to.eql(petId);\r",
									"});\r",
									"\r",
									"pm.test(\"FirstTagIdIsZero\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.tags[0].id).to.eql(0);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "0c2cfcc1-ecad-4fa4-931a-e24fdef4ca4e",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseURL}}/{{api_v}}/pet/:petId",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"{{api_v}}",
								"pet",
								":petId"
							],
							"variable": [
								{
									"key": "petId",
									"value": "{{petIdForCollection}}"
								}
							]
						}
					},
					"response": []
				}
			],
			"id": "330a0053-53b1-4d65-84d3-c481405c5f4c"
		},
		{
			"name": "DELETE",
			"item": [
				{
					"name": "delete by id",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "96bdb0cb-8418-4fb1-82c3-5dad2257020d",
								"exec": [
									"var petId = pm.collectionVariables.get(\"petIdForCollection\");\r",
									"pm.test(\"Body matches string\", function () {\r",
									"    pm.expect(pm.response.text()).to.include(petId);\r",
									"});\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"var url = pm.globals.get(\"baseURL\") + \"/\" + pm.collectionVariables.get(\"api_v\") + \"/pet/findByStatus?status=\" + pm.collectionVariables.get('var_status');\r",
									"const getPetByStatus = {\r",
									" url: url,\r",
									" method: 'GET',\r",
									" header: {\r",
									"  'Content-Type': 'application/json',\r",
									" },\r",
									"};\r",
									"\r",
									"// Execute the request\r",
									"pm.sendRequest(getPetByStatus, function (err, response) {\r",
									"    // Handle errors\r",
									"    if (err) {\r",
									"        console.error(\"Request failed:\", err);\r",
									"        return;\r",
									"    }\r",
									"    \r",
									"    // Parse response body\r",
									"    const responseData = response.json();\r",
									"    console.log(\"Pets Found:\", responseData.length);\r",
									"    \r",
									"    // Test: Verify successful response\r",
									"    pm.test(\"GET request - Status code is 200\", function () {\r",
									"        pm.expect(response.code).to.equal(200);\r",
									"    });\r",
									"    \r",
									"    // Test: Response is an array\r",
									"    pm.test(\"GET request - Response is an array\", function () {\r",
									"        pm.expect(responseData).to.be.an('array');\r",
									"    });\r",
									"    \r",
									"    // Test: Array contains pets\r",
									"    pm.test(\"GET request - Pets found\", function () {\r",
									"        pm.expect(responseData.length).to.be.above(0);\r",
									"    });\r",
									"    \r",
									"    // Test: Verify pet structure\r",
									"    pm.test(\"GET request - Pets have required fields\", function () {\r",
									"        if (responseData.length > 0) {\r",
									"            pm.expect(responseData[0]).to.have.property('id');\r",
									"            pm.expect(responseData[0]).to.have.property('name');\r",
									"            pm.expect(responseData[0]).to.have.property('status');\r",
									"        }\r",
									"    });\r",
									"    \r",
									"    // Additional validation\r",
									"    pm.test(\"GET request - Response time is acceptable\", function () {\r",
									"        pm.expect(response.responseTime).to.be.below(2000);\r",
									"    });\r",
									"});\r",
									"\r",
									"// remove ID for pet so that new cycle can create a new one\r",
									"//pm.collectionVariables.unset('petIdForCollection');\r",
									"//console.log('petIdForCollection is now: ' + pm.collectionVariables.get(\"petIdForCollection\"))"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "5c204cea-27c6-4b84-af12-adcaf87514c2",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseURL}}/{{api_v}}/pet/:petId",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"{{api_v}}",
								"pet",
								":petId"
							],
							"variable": [
								{
									"key": "petId",
									"value": "{{petIdForCollection}}"
								}
							]
						}
					},
					"response": []
				}
			],
			"id": "08f35559-0481-45eb-b9be-ee9d3733691d"
		},
		{
			"name": "PUT",
			"item": [
				{
					"name": "updates a pet status",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "5be0d334-2385-431e-99b5-5c15050ad694",
								"exec": [
									"pm.test(\"Status was updated\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.status).to.eql(pm.collectionVariables.get(\"var_status\"));\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "5646d183-bb1f-4b3e-8eac-67f380f53c6e",
								"exec": [
									"var localPetId = pm.collectionVariables.get(\"petIdForCollection\");\r",
									"console.log(\"Updating PetId: \" + localPetId)\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "0d637db0-2aab-4c48-8ee9-01c1ef32237d",
					"protocolProfileBehavior": {
						"disableBodyPruning": true,
						"disabledSystemHeaders": {
							"content-type": true
						}
					},
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"id\": {{petIdForCollection}},\r\n    \"category\": {\r\n        \"id\": 0,\r\n        \"name\": \"base_category_name - bus salmon\"\r\n    },\r\n    \"name\": \"doggie\",\r\n    \"photoUrls\": [\r\n        \"string\"\r\n    ],\r\n    \"tags\": [\r\n        {\r\n            \"id\": 0,\r\n            \"name\": \"string\"\r\n        }\r\n    ],\r\n    \"status\": \"{{var_status}}\"\r\n}"
						},
						"url": "{{baseURL}}/{{api_v}}/pet"
					},
					"response": []
				},
				{
					"name": "add tag to existing pet",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "c68acbb5-2156-40de-9c4b-0133b681eb6c",
								"exec": [
									"pm.test(\"Adding new tag with integer id\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.tags[1].id).to.eql(12);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "442c5eb5-1eb6-4311-aa76-1fc592c385c8",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"id\": {{petIdForCollection}},\r\n    \"category\": {\r\n        \"id\": 0,\r\n        \"name\": \"string\"\r\n    },\r\n    \"name\": \"doggie\",\r\n    \"photoUrls\": [\r\n        \"string\"\r\n    ],\r\n    \"tags\": [\r\n        {\r\n            \"id\": 0,\r\n            \"name\": \"string\"\r\n        },\r\n        {\r\n            \"id\": 12,\r\n            \"name\": \"string\"\r\n        }\r\n    ],\r\n    \"status\": \"{{var_status}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": "{{baseURL}}/{{api_v}}/pet"
					},
					"response": []
				}
			],
			"id": "8b8876f8-a1cc-4517-a272-253d2b3c120a"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "6ced4ea3-b9cc-4c3e-a0f3-4a179dd3f2ac",
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "9258aa09-be37-483e-95c0-fcd4e9c645bc",
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "petRandomCategoryBaseName",
			"value": "base_category_name"
		},
		{
			"key": "api_v",
			"value": "v2"
		},
		{
			"key": "var_status",
			"value": "sold"
		},
		{
			"key": "petIdForCollection",
			"value": 922337
		}
	]
}